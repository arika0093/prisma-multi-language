# 複数の言語での prisma schema の呼び出し 
複数のプログラミング言語でprisma schemaを使用するサンプルです。

## どういった用途か
例えば、以下のケースを想定しています:  
webサーバー機能をnodejs、データベースから1日1回バッチ処理を行い集計作業をpyhtonがそれぞれ担います。  
この際、nodeからの接続は`prisma-client-js`、pythonからの接続は`prisma-client-py`を用います。  
こういったケースの時にスキーマを共有できれば幸せになれますよね？  

## コンセプト
### スキーマ管理用フォルダ
スキーマ自体の管理、migrateによる環境の反映、studioによる編集環境の起動などに使用するフォルダです。

### 実際にプログラムが走るフォルダ
各フォルダで `prisma generate` を呼び出せるように構築しています。  
この場合、使用するジェネレータは言語ごとに異なるため、環境変数 `$PRISMA_CLIENT` で指定します。

## 中身
### `/prisma`
以下の内容が含まれています。
* スキーマファイルそのものです。
* 操作用のクライアントをインストールするための `package.json` です。  
主にこのフォルダの中で、スキーマ自体の編集と `migrate` を行います。

初期設定は以下のコマンドで行います。

```
cd ./prisma
npm install
npm run migrate
```

### `/node`
以下の内容が含まれています。
* 環境設定用の`package.json`
* 簡単なnode.jsのサンプル。

`npm install` で環境構築します。
スキーマを更新する場合は、`npm run update_schema` を実行します。

### `/python`
以下の内容が含まれています。
* 環境設定用の`Pipfile`
* 簡単な python の例

`pipenv install` で環境構築します。
スキーマを更新する際には `pipenv run update_schema` を実行します。

## +1
各フォルダの内容は、`schema.prisma`以外は独立しています!  
そのため、各フォルダ内の内容を別個に管理することで、DBスキーマの管理と実装の側面を分離することが可能です。  
その場合は、以下のような対応が必要になります。
* `git submodule` などを使用して、最新のスキーマファイルを参照できるようにする。
* `update_schema` コマンドで参照するスキーマファイルの参照先を変更する。
